<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Blog List - E-Learning Platform</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #f5f5f5;
                min-height: 100vh;
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
                background: white;
                min-height: 100vh;
                display: flex;
            }

            .header {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: white;
                padding: 15px 20px;
                border-bottom: 1px solid #e0e0e0;
                z-index: 1000;
            }

            .back-btn {
                background: #e0e0e0;
                color: #333;
                border: none;
                padding: 8px 16px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
                text-decoration: none;
                display: inline-block;
                transition: background-color 0.3s ease;
            }

            .back-btn:hover {
                background: #d0d0d0;
            }

            .main-content {
                display: flex;
                width: 100%;
                margin-top: 60px;
            }

            .sidebar {
                width: 250px;
                background: #f8f9fa;
                padding: 30px 20px;
                border-right: 1px solid #e0e0e0;
                height: calc(100vh - 60px);
                overflow-y: auto;
            }

            .blog-title {
                font-size: 2.5rem;
                font-weight: 900;
                color: #333;
                margin-bottom: 30px;
                letter-spacing: -1px;
            }

            .search-container {
                margin-bottom: 30px;
            }

            .search-input {
                width: 100%;
                padding: 10px 12px;
                border: 1px solid #ddd;
                border-radius: 6px;
                font-size: 14px;
                margin-bottom: 10px;
            }

            .search-btn {
                width: 100%;
                background: #007bff;
                color: white;
                border: none;
                padding: 10px;
                border-radius: 6px;
                cursor: pointer;
                font-weight: 500;
                font-size: 14px;
            }

            .search-btn:hover {
                background: #0056b3;
            }

            .category-section h3 {
                font-size: 1.2rem;
                font-weight: 600;
                color: #333;
                margin-bottom: 20px;
            }

            .category-tags {
                display: flex;
                flex-direction: column;
                gap: 8px;
                margin-bottom: 30px;
            }

            .category-tag {
                background: transparent;
                color: #495057;
                padding: 8px 0;
                font-size: 14px;
                cursor: pointer;
                border: none;
                transition: all 0.3s ease;
                text-decoration: none;
                text-align: left;
                border-radius: 0;
            }

            .category-tag:hover,
            .category-tag.active {
                color: #007bff;
                font-weight: 500;
            }

            .latest-posts h3 {
                font-size: 1.2rem;
                font-weight: 600;
                color: #333;
                margin-bottom: 20px;
            }

            .latest-post-item {
                margin-bottom: 15px;
                padding-bottom: 15px;
                border-bottom: 1px solid #e9ecef;
                cursor: pointer;
            }

            .latest-post-item:last-child {
                border-bottom: none;
            }

            .latest-post-item:hover {
                background: #f8f9fa;
                padding: 10px;
                border-radius: 6px;
                margin: -10px -10px 15px -10px;
            }

            .latest-post-title {
                font-size: 0.9rem;
                font-weight: 500;
                color: #333;
                line-height: 1.4;
                margin-bottom: 5px;
            }

            .contacts-section {
                margin-top: 30px;
                padding-top: 20px;
                border-top: 1px solid #e9ecef;
            }

            .contacts-section h3 {
                font-size: 1.2rem;
                font-weight: 600;
                color: #333;
                margin-bottom: 15px;
            }

            .contact-info {
                font-size: 0.9rem;
                color: #666;
                line-height: 1.6;
            }

            .content-area {
                flex: 1;
                padding: 30px;
                overflow-y: auto;
                height: calc(100vh - 60px);
            }

            .posts-container {
                max-width: 900px;
            }

            .post-card {
                background: white;
                border: 1px solid #e0e0e0;
                border-radius: 8px;
                margin-bottom: 20px;
                padding: 20px;
                display: flex;
                gap: 20px;
                transition: box-shadow 0.3s ease;
                cursor: pointer;
            }

            .post-card:hover {
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }

            .post-image {
                width: 120px;
                height: 90px;
                background: #f0f0f0;
                border-radius: 6px;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
                overflow: hidden;
            }

            .post-image img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            .placeholder-icon {
                width: 40px;
                height: 40px;
                background: #ccc;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 4px;
            }

            .placeholder-icon::before {
                content: "üñºÔ∏è";
                font-size: 20px;
            }

            .post-content {
                flex: 1;
            }

            .post-title {
                font-size: 1.1rem;
                font-weight: 600;
                color: #333;
                margin-bottom: 8px;
                line-height: 1.4;
            }

            .post-meta {
                color: #666;
                font-size: 0.85rem;
                margin-bottom: 10px;
            }

            .post-link {
                color: #007bff;
                font-size: 0.85rem;
                text-decoration: none;
                margin-bottom: 8px;
                display: block;
            }

            .post-description {
                color: #555;
                font-size: 0.9rem;
                line-height: 1.5;
            }

            .pagination {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 10px;
                margin-top: 30px;
                padding: 20px 0;
                border-top: 1px solid #e0e0e0;
            }

            .pagination button {
                background: #f8f9fa;
                border: 1px solid #dee2e6;
                color: #495057;
                padding: 8px 12px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
            }

            .pagination button:hover:not(:disabled) {
                background: #e9ecef;
            }

            .pagination button.active {
                background: #007bff;
                color: white;
                border-color: #007bff;
            }

            .pagination button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .loading, .error, .no-posts {
                text-align: center;
                padding: 60px;
                color: #666;
            }

            .spinner {
                border: 4px solid #f3f3f3;
                border-top: 4px solid #007bff;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                animation: spin 1s linear infinite;
                margin: 0 auto 20px;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            @media (max-width: 768px) {
                .main-content {
                    flex-direction: column;
                }

                .sidebar {
                    width: 100%;
                    height: auto;
                    position: static;
                }

                .blog-title {
                    font-size: 2rem;
                }

                .post-card {
                    flex-direction: column;
                }

                .post-image {
                    width: 100%;
                    height: 120px;
                }
            }
        </style>
    </head>
    <body>
        <div class="header">
            <a href="#" class="back-btn">‚Üê Back</a>
        </div>

        <div class="container">
            <div class="main-content">
                <div class="sidebar">
                    <h1 class="blog-title">Blog list</h1>

                    <div class="search-container">
                        <input type="text" class="search-input" placeholder="Search posts..." id="searchInput">
                        <button class="search-btn" onclick="searchPosts()">Search</button>
                    </div>

                    <div class="category-section">
                        <h3>Category</h3>
                        <div class="category-tags" id="categoryTags">
                            <!-- Categories will be populated by JavaScript -->
                        </div>
                    </div>

                    <div class="latest-posts">
                        <h3>Latest Posts</h3>
                        <div id="latestPostsList">
                            <!-- Latest posts will be populated by JavaScript -->
                        </div>
                    </div>

                    <div class="contacts-section">
                        <h3>Contacts</h3>
                        <div class="contact-info">
                            Abcxyz@gmail.com<br>
                            Hotline: 0936557248
                        </div>
                    </div>
                </div>

                <div class="content-area">
                    <div id="loadingState" class="loading">
                        <div class="spinner"></div>
                        Loading posts...
                    </div>

                    <div id="errorState" class="error" style="display: none;">
                        Error loading posts. Please try again later.
                    </div>

                    <div id="mainContent" style="display: none;">
                        <div class="posts-container" id="postsContainer">
                            <!-- Posts will be populated by JavaScript -->
                        </div>

                        <div class="pagination" id="pagination">
                            <!-- Pagination will be populated by JavaScript -->
                        </div>
                    </div>

                    <div id="noPostsState" class="no-posts" style="display: none;">
                        No posts found.
                    </div>
                </div>
            </div>
        </div>

        <script>
            let allPosts = [];
            let filteredPosts = [];
            let currentPage = 1;
            let postsPerPage = 5;
            let selectedCategory = '';

            // Call your actual API
            async function fetchPosts() {
                try {
                    const response = await fetch('http://localhost:9999/EducationPlatform/post-api');

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();

                    if (result.success && result.data) {
                        return result.data;
                    } else {
                        throw new Error(result.message || 'Failed to fetch posts');
                    }
                } catch (error) {
                    console.error('Error fetching posts:', error);
                    throw error;
                }
            }

            // Fallback mock data
            function getMockPosts() {
                return [
                    {
                        id: 1,
                        title: "Ever wondered how to optimize your test preparation?",
                        content: "Instead of passive or unstructured studying, it encourages the use of scientifically proven strategies such as creating study plans, managing self-testing, and employing study tools like mind maps and flashcards. The article highlights the importance of understanding individual learning styles and maintaining mental well-being throughout the study process. The ultimate goal is to help learners retain knowledge better, build confidence, and achieve higher results in their exams.",
                        thumbnail: "",
                        category: "Learning",
                        createdAt: "2025-05-15T00:00:00Z",
                        author: {
                            fullName: "ABCxyz"
                        }
                    },
                    {
                        id: 2,
                        title: "In this article, we'll explore the best methods to turn practice tests into a powerful tool to help you score high.",
                        content: "Practice tests are not just a way to measure what you know ‚Äî they are one of the most effective tools for active learning and performance improvement. When used strategically, they can significantly boost both content retention and test-taking confidence.",
                        thumbnail: "",
                        category: "Learning",
                        createdAt: "2025-05-15T00:00:00Z",
                        author: {
                            fullName: "ABCxyz"
                        }
                    },
                    {
                        id: 3,
                        title: "Common mistakes when practicing and how to avoid them",
                        content: "Even with the best intentions, many students fall into habits that make their test preparation less effective. Below are some of the most common mistakes ‚Äî and how to avoid them to make your study time truly count.",
                        thumbnail: "",
                        category: "Test",
                        createdAt: "2025-05-15T00:00:00Z",
                        author: {
                            fullName: "ABCxyz"
                        }
                    },
                    {
                        id: 4,
                        title: "Janie's secret: Student reaches N3 in 3 months",
                        content: "Janie has proven that with the right learning method, achieving N3 level of Japanese in just three months is completely possible.",
                        thumbnail: "",
                        category: "Certificate",
                        createdAt: "2025-05-17T00:00:00Z",
                        author: {
                            fullName: "Alcunz"
                        }
                    },
                    {
                        id: 5,
                        title: "How to turn practice tests into effective learning tools?",
                        content: "Transform your practice sessions into powerful learning experiences with these proven strategies.",
                        thumbnail: "",
                        category: "Learning",
                        createdAt: "2025-05-16T00:00:00Z",
                        author: {
                            fullName: "ABCxyz"
                        }
                    },
                    {
                        id: 6,
                        title: "Learning to code has never been so difficult.",
                        content: "Explore the challenges and solutions in modern programming education.",
                        thumbnail: "",
                        category: "Lifestyle",
                        createdAt: "2025-05-14T00:00:00Z",
                        author: {
                            fullName: "ABCxyz"
                        }
                    },
                    {
                        id: 7,
                        title: "N3 is your wish?",
                        content: "Make your Japanese N3 certification dreams come true with these proven strategies.",
                        thumbnail: "",
                        category: "Certificate",
                        createdAt: "2025-05-13T00:00:00Z",
                        author: {
                            fullName: "ABCxyz"
                        }
                    },
                    {
                        id: 8,
                        title: "Creative Writing Tips for Beginners",
                        content: "Discover essential techniques to improve your creative writing skills and express your ideas effectively.",
                        thumbnail: "",
                        category: "Writing",
                        createdAt: "2025-05-12T00:00:00Z",
                        author: {
                            fullName: "ABCxyz"
                        }
                    }
                ];
            }

            // Format date
            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            }

            // Extract unique categories
            function getCategories(posts) {
                const categories = [...new Set(posts.map(post => post.category).filter(cat => cat))];
                return categories.sort();
            }

            // Create category tags
            function createCategoryTags(categories) {
                const categoryTags = document.getElementById('categoryTags');

                // Add "All" tag
                const allTag = document.createElement('span');
                allTag.className = 'category-tag active';
                allTag.textContent = 'All';
                allTag.onclick = () => filterByCategory('');
                categoryTags.appendChild(allTag);

                // Add category tags
                categories.forEach(category => {
                    const tag = document.createElement('span');
                    tag.className = 'category-tag';
                    tag.textContent = category;
                    tag.onclick = () => filterByCategory(category);
                    categoryTags.appendChild(tag);
                });
            }

            // Filter by category
            function filterByCategory(category) {
                selectedCategory = category;
                currentPage = 1;

                // Update active tag
                document.querySelectorAll('.category-tag').forEach(tag => {
                    tag.classList.remove('active');
                    if ((category === '' && tag.textContent === 'All') ||
                            tag.textContent === category) {
                        tag.classList.add('active');
                    }
                });

                applyFilters();
            }

            // Apply all filters
            function applyFilters() {
                let posts = [...allPosts];

                // Filter by category
                if (selectedCategory) {
                    posts = posts.filter(post => post.category === selectedCategory);
                }

                // Filter by search term
                const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
                if (searchTerm) {
                    posts = posts.filter(post =>
                        post.title.toLowerCase().includes(searchTerm) ||
                                (post.content && post.content.toLowerCase().includes(searchTerm))
                    );
                }

                filteredPosts = posts;
                displayPosts();
            }

            // Search functionality
            function searchPosts() {
                currentPage = 1;
                applyFilters();
            }

            // Create post card HTML
            function createPostCard(post) {
                const imageHtml = post.thumbnail && post.thumbnail.trim() !== ''
                        ? `<img src="${post.thumbnail}" alt="${post.title}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                       <div class="placeholder-icon" style="display: none;"></div>`
                        : `<div class="placeholder-icon"></div>`;

                return `
                    <div class="post-card" onclick="viewPost(${post.id})">
                        <div class="post-image">
                            ${imageHtml}
                        </div>
                        <div class="post-content">
                            <h3 class="post-title">${post.title}</h3>
                            <div class="post-meta">${post.category || 'Uncategorized'} - ${formatDate(post.createdAt)} by ${post.author ? post.author.fullName : 'Unknown'}</div>
                            <a href="#" class="post-link">Link - Abcxyz.com</a>
                            <p class="post-description">${post.content ? post.content.substring(0, 200) + (post.content.length > 200 ? '...' : '') : 'No description available.'}</p>
                        </div>
                    </div>
                `;
            }

            // Display posts with pagination
            function displayPosts() {
                if (filteredPosts.length === 0) {
                    showNoPosts();
                    return;
                }

                const startIndex = (currentPage - 1) * postsPerPage;
                const endIndex = startIndex + postsPerPage;
                const paginatedPosts = filteredPosts.slice(startIndex, endIndex);

                const postsContainer = document.getElementById('postsContainer');
                postsContainer.innerHTML = paginatedPosts.map(post => createPostCard(post)).join('');

                createPagination();
                showMainContent();
            }

            // Create pagination
            function createPagination() {
                const totalPages = Math.ceil(filteredPosts.length / postsPerPage);
                const pagination = document.getElementById('pagination');

                if (totalPages <= 1) {
                    pagination.style.display = 'none';
                    return;
                }

                pagination.style.display = 'flex';
                pagination.innerHTML = '';

                // Previous button
                const prevBtn = document.createElement('button');
                prevBtn.textContent = 'Prev';
                prevBtn.disabled = currentPage === 1;
                prevBtn.onclick = () => {
                    if (currentPage > 1) {
                        currentPage--;
                        displayPosts();
                    }
                };
                pagination.appendChild(prevBtn);

                // Page numbers
                for (let i = 1; i <= totalPages; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.textContent = i;
                    pageBtn.className = i === currentPage ? 'active' : '';
                    pageBtn.onclick = () => {
                        currentPage = i;
                        displayPosts();
                    };
                    pagination.appendChild(pageBtn);
                }

                // Next button
                const nextBtn = document.createElement('button');
                nextBtn.textContent = 'Next';
                nextBtn.disabled = currentPage === totalPages;
                nextBtn.onclick = () => {
                    if (currentPage < totalPages) {
                        currentPage++;
                        displayPosts();
                    }
                };
                pagination.appendChild(nextBtn);
            }

            // Create latest posts sidebar
            function createLatestPosts(posts) {
                const latestPosts = posts.slice(0, 5); // Show 5 latest posts
                const latestPostsList = document.getElementById('latestPostsList');

                latestPostsList.innerHTML = latestPosts.map(post => `
                    <div class="latest-post-item" onclick="viewPost(${post.id})">
                        <div class="latest-post-title">${post.title}</div>
                    </div>
                `).join('');
            }

            // Enter key search
            document.addEventListener('DOMContentLoaded', function () {
                document.getElementById('searchInput').addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        searchPosts();
                    }
                });
            });

            // View post
            function viewPost(postId) {
                alert(`View post with ID: ${postId}`);
            }

            // State management functions
            function showLoading() {
                document.getElementById('loadingState').style.display = 'block';
                document.getElementById('errorState').style.display = 'none';
                document.getElementById('mainContent').style.display = 'none';
                document.getElementById('noPostsState').style.display = 'none';
            }

            function showError() {
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('errorState').style.display = 'block';
                document.getElementById('mainContent').style.display = 'none';
                document.getElementById('noPostsState').style.display = 'none';
            }

            function showMainContent() {
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('errorState').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                document.getElementById('noPostsState').style.display = 'none';
            }

            function showNoPosts() {
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('errorState').style.display = 'none';
                document.getElementById('mainContent').style.display = 'none';
                document.getElementById('noPostsState').style.display = 'block';
            }

            // Initialize the page
            async function loadPosts() {
                try {
                    showLoading();

                    let posts;
                    try {
                        posts = await fetchPosts();
                        console.log('Posts loaded from API:', posts);
                    } catch (apiError) {
                        console.warn('API not available, using mock data:', apiError);
                        posts = getMockPosts();
                    }

                    allPosts = posts;
                    filteredPosts = [...allPosts];

                    if (posts.length === 0) {
                        showNoPosts();
                    } else {
                        // Create categories
                        const categories = getCategories(posts);
                        createCategoryTags(categories);

                        // Create latest posts
                        createLatestPosts(posts);

                        // Display posts
                        displayPosts();
                    }
                } catch (error) {
                    console.error('Error loading posts:', error);
                    showError();
                }
            }

            // Load posts when page loads
            window.addEventListener('load', loadPosts);
        </script>
    </body>
</html>